version: "1.0"
namespace: "com.tollcenter.ontology"

# ============================================
# 数据源连接配置
# ============================================
data_sources:
  - id: local_h2
    type: h2
    host: file
    port: 0
    database: mypalantir
    username: sa
    password: ""
    jdbc_url: jdbc:h2:file:./data/h2/mypalantir
    properties:
      AUTO_SERVER: false
      DB_CLOSE_DELAY: -1

# ============================================
# 核心业务实体层（Entity Layer）
# 可独立管理，有生命周期的业务实体
# ============================================

object_types:
  # 收费站（聚合根）
  - name: TollStation
    display_name: 收费站
    description: "高速公路收费站，包含多个车道"
    properties:
      - name: station_id
        display_name: 收费站编号
        data_type: string
        required: true
        description: "收费站唯一标识（系统内部编号，如 S0085370010030）"
      - name: station_name
        display_name: 收费站名称
        data_type: string
        required: false
        description: "收费站名称（如：山东海湾大桥站、沂源北）"
      - name: station_name_hex
        display_name: 收费站HEX编码
        data_type: string
        required: false
        description: "收费站HEX编码（如：37012C13）"
      - name: station_id_national
        display_name: 收费站编号(国标)
        data_type: string
        required: false
        description: "收费站编号(国标格式，如：220103）"
      - name: center_id
        display_name: 所属中心
        data_type: string
        required: false
        description: "所属中心编号（如：22、72）"
      - name: sub_center_id
        display_name: 所属分中心
        data_type: string
        required: false
        description: "所属分中心编号（如：2201、7214）"
    data_source:
      connection_id: local_h2
      table: TOLL_STATIONS
      id_column: station_id
      field_mapping:
        station_id: STATION_ID
        station_name: STATION_NAME
        station_name_hex: STATION_NAME_HEX
        station_id_national: STATION_ID_NATIONAL
        center_id: CENTER_ID
        sub_center_id: SUB_CENTER_ID

  # 车道（属于收费站）
  - name: TollLane
    display_name: 收费车道
    description: "收费站内的收费车道"
    properties:
      - name: lane_id
        display_name: 车道编号
        data_type: string
        required: true
        description: "车道唯一标识（系统内部编号，如 S00853700100301010090）"
      - name: lane_number
        display_name: 车道号
        data_type: string
        required: false
        description: "车道号（如：03、95）"
      - name: lane_number_hex
        display_name: 车道号HEX编码
        data_type: string
        required: false
        description: "车道号HEX编码（如：37012C1303）"
      - name: lane_type
        display_name: 车道类型
        data_type: int
        required: false
        description: "车道类型（1=入口，2=出口）"
      - name: lane_app_ver
        display_name: 车道程序版本号
        data_type: string
        required: false
        description: "车道程序版本号（如：3.5.2.7）"
    data_source:
      connection_id: local_h2
      table: TOLL_LANES
      id_column: lane_id
      field_mapping:
        lane_id: LANE_ID
        lane_number: LANE_NUMBER
        lane_number_hex: LANE_NUMBER_HEX
        lane_type: LANE_TYPE
        lane_app_ver: LANE_APP_VER

  # 门架（独立实体）
  - name: Gantry
    display_name: ETC门架
    description: "高速公路上的ETC计费门架"
    properties:
      - name: gantry_id
        display_name: 门架编号
        data_type: string
        required: true
        description: "门架唯一标识（如：G201137004001420120）"
      - name: gantry_hex
        display_name: 门架HEX编码
        data_type: string
        required: false
        description: "门架HEX编码（如：3D010C）"
      - name: gantry_order_num
        display_name: 门架顺序号
        data_type: int
        required: false
        description: "门架顺序号（如：201）"
      - name: gantry_type
        display_name: 门架类型
        data_type: int
        required: false
        description: "门架类型（如：1）"
    data_source:
      connection_id: local_h2
      table: GANTRIES
      id_column: gantry_id
      field_mapping:
        gantry_id: GANTRY_ID
        gantry_hex: GANTRY_HEX
        gantry_order_num: GANTRY_ORDER_NUM
        gantry_type: GANTRY_TYPE

  # 操作员（聚合根）
  - name: Operator
    display_name: 操作员
    description: "收费站操作员（包含班长信息）"
    properties:
      - name: oper_id
        display_name: 操作员工号
        data_type: string
        required: true
        description: "操作员唯一标识（如：999999999）"
      - name: oper_name
        display_name: 操作员姓名
        data_type: string
        required: false
        description: "操作员姓名（如：ETC操作员）"
      - name: monitor_id
        display_name: 班长工号
        data_type: string
        required: false
        description: "班长工号（作为操作员属性，可能为空或0）"
      - name: monitor_name
        display_name: 班长名称
        data_type: string
        required: false
        description: "班长名称（作为操作员属性，可能为空或0）"
    data_source:
      connection_id: local_h2
      table: OPERATORS
      id_column: oper_id
      field_mapping:
        oper_id: OPER_ID
        oper_name: OPER_NAME
        monitor_id: MONITOR_ID
        monitor_name: MONITOR_NAME

  # 车辆（聚合根）
  - name: Vehicle
    display_name: 车辆
    description: "通行车辆"
    properties:
      - name: vehicle_id
        display_name: 车辆标识
        data_type: string
        required: true
        description: "车辆唯一标识（车牌号+车牌颜色的组合）"
      - name: plate_num
        display_name: 车牌号
        data_type: string
        required: false
        description: "车牌号"
      - name: plate_color
        display_name: 车牌颜色
        data_type: int
        required: false
        description: "车牌颜色代码"
      - name: vehicle_type
        display_name: 车辆类型
        data_type: int
        required: false
        description: "车辆类型"
      - name: vehicle_class
        display_name: 车种
        data_type: int
        required: false
        description: "车种"
    data_source:
      connection_id: local_h2
      table: VEHICLES
      id_column: vehicle_id
      field_mapping:
        vehicle_id: VEHICLE_ID
        plate_num: PLATE_NUM
        plate_color: PLATE_COLOR
        vehicle_type: VEHICLE_TYPE
        vehicle_class: VEHICLE_CLASS

  # 通行介质（聚合根）
  - name: Media
    display_name: 通行介质
    description: "ETC/CPC卡或OBU设备"
    properties:
      - name: media_id
        display_name: 介质标识
        data_type: string
        required: true
        description: "介质唯一标识（优先使用OBUID，其次CARDID，再次MEDIANO）"
      - name: media_type
        display_name: 介质类型
        data_type: int
        required: false
        description: "介质类型（如：1）"
      - name: card_id
        display_name: 卡号
        data_type: string
        required: false
        description: "ETC/CPC卡号（如：1801230801665204）"
      - name: card_net
        display_name: 卡网络号
        data_type: string
        required: false
        description: "ETC/CPC卡网络号（如：3701）"
      - name: obu_id
        display_name: OBU编号
        data_type: string
        required: false
        description: "OBU编号（如：3701071967182248）"
      - name: obu_issue_flag
        display_name: OBU发行方标识
        data_type: string
        required: false
        description: "OBU发行方标识（如：c9bdb6ab37010001）"
    data_source:
      connection_id: local_h2
      table: MEDIA
      id_column: media_id
      field_mapping:
        media_id: MEDIA_ID
        media_type: MEDIA_TYPE
        card_id: CARD_ID
        card_net: CARD_NET
        obu_id: OBU_ID
        obu_issue_flag: OBU_ISSUE_FLAG

  # ============================================
  # 交易事实层（Fact Layer）
  # 事件记录，包含快照信息
  # ============================================

  # 入口交易（事实表）
  - name: EntryTransaction
    display_name: 入口交易
    description: "车辆入口交易记录（事实表）"
    data_source:
      connection_id: local_h2
      table: TBL_ENTRYWASTE
      id_column: ID
      field_mapping:
        交易流水号: ID
        通行标识: PASSID
        交易时间: ENTIME
        逻辑日期: LDATE
        压线圈时间: TRIGGERTIME
        接收时间: RECEIVETIME
        收费站编号（快照）: ENTOLLSTATIONID
        车道号（快照）: ENTOLLLANE
        操作员姓名（快照）: OPERNAME
        班长名称（快照）: MONITORNAME
        车牌号（快照）: VLP
        车牌颜色（快照）: VLPC
        车型（快照）: VEHICLETYPE
        交易编码: TRANSCODE
        交易类型: TRANSTYPE
        批次号: BATCHNUM
        班次: SHIFT
        入口重量: ENWEIGHT
        入口轴数: ENAXLECOUNT
        交易前余额（分）: BALANCEBEFORE
        卡面扣费金额: TRANSFEE
        TAC码: TAC
        终端机编号: TERMINALNO
        部特情类型: SPECIALTYPE
        业务分析特情状态: SPINFO
        交易描述: DESCRIPTION
        校验码: VERIFYCODE
        校检标志: VERIFYFLAG
    properties:
      # 核心标识
      - name: id
        display_name: 交易流水号
        data_type: string
        required: true
        description: "交易流水号"
      - name: pass_id
        display_name: 通行标识
        data_type: string
        required: false
        description: "通行标识ID"
      
      # 时间信息
      - name: trans_time
        display_name: 交易时间
        data_type: date
        required: false
        description: "交易时间"
      - name: l_date
        display_name: 逻辑日期
        data_type: date
        required: false
        description: "逻辑日期"
      - name: trigger_time
        display_name: 压线圈时间
        data_type: string
        required: false
        description: "压线圈时间"
      - name: receive_time
        display_name: 接收时间
        data_type: date
        required: false
        description: "接收时间"
      
      # 快照信息（交易发生时的状态，用于历史查询）
      - name: snapshot_station_id
        display_name: 收费站编号（快照）
        data_type: string
        required: false
        description: "交易时的收费站编号"
      - name: snapshot_lane_number
        display_name: 车道号（快照）
        data_type: string
        required: false
        description: "交易时的车道号"
      - name: snapshot_oper_name
        display_name: 操作员姓名（快照）
        data_type: string
        required: false
        description: "交易时的操作员姓名"
      - name: snapshot_monitor_name
        display_name: 班长名称（快照）
        data_type: string
        required: false
        description: "交易时的班长名称"
      - name: snapshot_plate_num
        display_name: 车牌号（快照）
        data_type: string
        required: false
        description: "交易时的车牌号"
      - name: snapshot_plate_color
        display_name: 车牌颜色（快照）
        data_type: int
        required: false
        description: "交易时的车牌颜色"
      - name: snapshot_vehicle_type
        display_name: 车型（快照）
        data_type: int
        required: false
        description: "交易时的车型"
      
      # 交易业务数据
      - name: trans_code
        display_name: 交易编码
        data_type: string
        required: false
        description: "交易编码"
      - name: trans_type
        display_name: 交易类型
        data_type: string
        required: false
        description: "交易类型"
      - name: batch_num
        display_name: 批次号
        data_type: string
        required: false
        description: "批次号"
      - name: shift
        display_name: 班次
        data_type: string
        required: false
        description: "班次"
      - name: en_weight
        display_name: 入口重量
        data_type: string
        required: false
        description: "入口重量"
      - name: en_axle_count
        display_name: 入口轴数
        data_type: int
        required: false
        description: "入口轴数"
      - name: balance_before
        display_name: 交易前余额（分）
        data_type: int
        required: false
        description: "交易前余额（分）"
      - name: trans_fee
        display_name: 卡面扣费金额
        data_type: int
        required: false
        description: "卡面扣费金额"
      - name: tac
        display_name: TAC码
        data_type: string
        required: false
        description: "TAC码"
      - name: terminal_no
        display_name: 终端机编号
        data_type: string
        required: false
        description: "终端机编号"
      - name: special_type
        display_name: 部特情类型
        data_type: string
        required: false
        description: "部特情类型"
      - name: sp_info
        display_name: 业务分析特情状态
        data_type: string
        required: false
        description: "业务分析特情状态"
      - name: description
        display_name: 交易描述
        data_type: string
        required: false
        description: "对交易的文字解释"
      - name: verify_code
        display_name: 校验码
        data_type: string
        required: false
        description: "校验码"
      - name: verify_flag
        display_name: 校检标志
        data_type: int
        required: false
        description: "校检标志"

  # 出口交易（事实表）
  - name: ExitTransaction
    display_name: 出口交易
    description: "车辆出口交易记录（事实表）"
    data_source:
      connection_id: local_h2
      table: TBL_EXITWASTE
      id_column: ID
      field_mapping:
        交易流水号: ID
        通行标识: PASSID
        交易时间: EXTIME
        入口时间（历史）: ENTIME
        逻辑日期: LDATE
        接收时间: RECEIVETIME
        入口收费站名称（快照）: ENTOLLSTATIONNAME
        出口收费站名称（快照）: EXTOLLSTATIONNAME
        出口车道号（快照）: EXTOLLLANE
        操作员姓名（快照）: OPERNAME
        车牌号（快照）: EXVLP
        车牌颜色（快照）: EXVLPC
        车型（快照）: EXVEHICLETYPE
        总交易金额: FEE
        应收金额: PAYFEE
        优惠金额: DISCOUNTFEE
        卡面扣费金额: TRANSFEE
        计费里程（米）: TOLLDISTANCE
        实际里程(米): REALDISTANCE
        超时时间(秒): OVERTIME
        发票代码: INVOICECODE
        发票编号: INVOICEID
        支付类型: PAYTYPE
        支付卡类型: PAYCARDTYPE
        是否多省交易: MULTIPROVINCE
        交易编码: TRANSCODE
        交易类型: TRANSTYPE
        部特情类型: SPECIALTYPE
        交易描述: DESCRIPTION
    properties:
      # 核心标识
      - name: id
        display_name: 交易流水号
        data_type: string
        required: true
        description: "交易流水号"
      - name: pass_id
        display_name: 通行标识
        data_type: string
        required: false
        description: "通行标识ID"
      
      # 时间信息
      - name: trans_time
        display_name: 交易时间
        data_type: date
        required: false
        description: "交易时间"
      - name: en_time
        display_name: 入口时间（历史）
        data_type: date
        required: false
        description: "入口时间"
      - name: l_date
        display_name: 逻辑日期
        data_type: date
        required: false
        description: "逻辑日期"
      - name: receive_time
        display_name: 接收时间
        data_type: date
        required: false
        description: "接收时间"
      
      # 快照信息
      - name: snapshot_en_station_name
        display_name: 入口收费站名称（快照）
        data_type: string
        required: false
        description: "入口时的收费站名称"
      - name: snapshot_ex_station_name
        display_name: 出口收费站名称（快照）
        data_type: string
        required: false
        description: "出口时的收费站名称"
      - name: snapshot_ex_lane_number
        display_name: 出口车道号（快照）
        data_type: string
        required: false
        description: "出口时的车道号"
      - name: snapshot_oper_name
        display_name: 操作员姓名（快照）
        data_type: string
        required: false
        description: "交易时的操作员姓名"
      - name: snapshot_plate_num
        display_name: 车牌号（快照）
        data_type: string
        required: false
        description: "交易时的车牌号"
      - name: snapshot_plate_color
        display_name: 车牌颜色（快照）
        data_type: int
        required: false
        description: "交易时的车牌颜色"
      - name: snapshot_vehicle_type
        display_name: 车型（快照）
        data_type: int
        required: false
        description: "交易时的车型"
      
      # 费用信息（核心业务数据）
      - name: fee
        display_name: 总交易金额
        data_type: int
        required: false
        description: "总交易金额"
      - name: pay_fee
        display_name: 应收金额
        data_type: int
        required: false
        description: "应收金额"
      - name: discount_fee
        display_name: 优惠金额
        data_type: int
        required: false
        description: "优惠金额"
      - name: trans_fee
        display_name: 卡面扣费金额
        data_type: int
        required: false
        description: "卡面扣费金额"
      - name: toll_distance
        display_name: 计费里程（米）
        data_type: int
        required: false
        description: "计费里程（米）"
      - name: real_distance
        display_name: 实际里程(米)
        data_type: int
        required: false
        description: "实际里程(米)"
      - name: over_time
        display_name: 超时时间(秒)
        data_type: int
        required: false
        description: "超时时间(秒)"
      - name: invoice_code
        display_name: 发票代码
        data_type: string
        required: false
        description: "发票代码"
      - name: invoice_id
        display_name: 发票编号
        data_type: string
        required: false
        description: "发票编号"
      - name: pay_type
        display_name: 支付类型
        data_type: int
        required: false
        description: "支付类型"
      - name: pay_card_type
        display_name: 支付卡类型
        data_type: int
        required: false
        description: "支付卡类型"
      - name: multi_province
        display_name: 是否多省交易
        data_type: int
        required: false
        description: "是否多省交易"
      - name: trans_code
        display_name: 交易编码
        data_type: string
        required: false
        description: "交易编码"
      - name: trans_type
        display_name: 交易类型
        data_type: string
        required: false
        description: "交易类型"
      - name: special_type
        display_name: 部特情类型
        data_type: string
        required: false
        description: "部特情类型"
      - name: description
        display_name: 交易描述
        data_type: string
        required: false
        description: "交易描述"

  # 门架交易（事实表）
  - name: GantryTransaction
    display_name: 门架交易
    description: "ETC门架计费交易记录（事实表）"
    data_source:
      connection_id: local_h2
      table: TBL_GANTRYWASTE
      id_column: TRADEID
      field_mapping:
        计费交易编号: TRADEID
        通行标识: PASSID
        计费交易时间: TRANSTIME
        通过上个门架的时间: LASTGANTRYTIME
        接收时间: RECEIVETIME
        门架HEX编码（快照）: GANTRYHEX
        上个门架HEX（快照）: LASTGANTRYHEX
        车牌号（快照）: VLP
        车牌颜色（快照）: VLPC
        车型（快照）: VEHICLETYPE
        应收金额: PAYFEE
        交易金额: FEE
        优惠金额: DISCOUNTFEE
        卡面扣费金额: TRANSFEE
        计费里程数: FEEMILEAGE
        收费单元编号组合: TOLLINTERVALID
        门架顺序号: GANTRYORDERNUM
        交易前余额（分）: BALANCEBEFORE
        交易后余额（分）: BALANCEAFTER
        交易类型标识: TRANSTYPE
        匹配状态: MATCHSTATUS
        去重状态: VALIDSTATUS
        处理状态: DEALSTATUS
        对交易的文字解释: DESCRIPTION
    properties:
      # 核心标识
      - name: trade_id
        display_name: 计费交易编号
        data_type: string
        required: true
        description: "计费交易编号"
      - name: pass_id
        display_name: 通行标识
        data_type: string
        required: false
        description: "通行标识ID"
      
      # 时间信息
      - name: trans_time
        display_name: 计费交易时间
        data_type: date
        required: false
        description: "计费交易时间"
      - name: last_gantry_time
        display_name: 通过上个门架的时间
        data_type: date
        required: false
        description: "通过上个门架的时间"
      - name: receive_time
        display_name: 接收时间
        data_type: date
        required: false
        description: "接收时间"
      
      # 快照信息
      - name: snapshot_gantry_hex
        display_name: 门架HEX编码（快照）
        data_type: string
        required: false
        description: "交易时的门架HEX编码"
      - name: snapshot_last_gantry_hex
        display_name: 上个门架HEX（快照）
        data_type: string
        required: false
        description: "交易时的上个门架HEX编码"
      - name: snapshot_plate_num
        display_name: 车牌号（快照）
        data_type: string
        required: false
        description: "交易时的车牌号"
      - name: snapshot_plate_color
        display_name: 车牌颜色（快照）
        data_type: int
        required: false
        description: "交易时的车牌颜色"
      - name: snapshot_vehicle_type
        display_name: 车型（快照）
        data_type: int
        required: false
        description: "交易时的车型"
      
      # 计费信息
      - name: pay_fee
        display_name: 应收金额
        data_type: int
        required: false
        description: "应收金额"
      - name: fee
        display_name: 交易金额
        data_type: int
        required: false
        description: "交易金额"
      - name: discount_fee
        display_name: 优惠金额
        data_type: int
        required: false
        description: "优惠金额"
      - name: trans_fee
        display_name: 卡面扣费金额
        data_type: int
        required: false
        description: "卡面扣费金额"
      - name: fee_mileage
        display_name: 计费里程数
        data_type: int
        required: false
        description: "计费里程数"
      - name: toll_interval_id
        display_name: 收费单元编号组合
        data_type: string
        required: false
        description: "收费单元编号组合"
      - name: gantry_order_num
        display_name: 门架顺序号
        data_type: int
        required: false
        description: "门架顺序号"
      - name: balance_before
        display_name: 交易前余额（分）
        data_type: int
        required: false
        description: "交易前余额（分）"
      - name: balance_after
        display_name: 交易后余额（分）
        data_type: int
        required: false
        description: "交易后余额（分）"
      - name: trans_type
        display_name: 交易类型标识
        data_type: string
        required: false
        description: "交易类型标识"
      - name: match_status
        display_name: 匹配状态
        data_type: int
        required: false
        description: "匹配状态"
      - name: valid_status
        display_name: 去重状态
        data_type: int
        required: false
        description: "去重状态"
      - name: deal_status
        display_name: 处理状态
        data_type: int
        required: false
        description: "处理状态"
      - name: description
        display_name: 对交易的文字解释
        data_type: string
        required: false
        description: "对交易的文字解释"

  # ============================================
  # 聚合根层（Aggregate Root Layer）
  # ============================================

  # 通行路径（聚合根）
  - name: Passage
    display_name: 通行路径
    description: "车辆完整通行路径（聚合根），聚合入口、门架、出口交易"
    data_source:
      connection_id: local_h2
      table: TBL_PATH
      id_column: PASSID
      field_mapping:
        通行标识: PASSID
        车牌号: PLATENUM
        车牌颜色: PLATECOLOR
        入口时间: ENTIME
        出口时间: EXTIME
        入口收费站编号: ENTOLLSTATIONID
        出口收费站编号: EXTOLLSTATIONID
        入口车道编号: ENTOLLLANEID
        出口车道编号: EXTOLLLANEID
    properties:
      - name: pass_id
        display_name: 通行标识
        data_type: string
        required: true
        description: "通行唯一标识"
      - name: plate_num
        display_name: 车牌号
        data_type: string
        required: false
        description: "车牌号"
      - name: plate_color
        display_name: 车牌颜色
        data_type: int
        required: false
        description: "车牌颜色"
      - name: en_time
        display_name: 入口时间
        data_type: date
        required: false
        description: "入口时间"
      - name: ex_time
        display_name: 出口时间
        data_type: date
        required: false
        description: "出口时间"
      - name: en_station_id
        display_name: 入口收费站编号
        data_type: string
        required: false
        description: "入口收费站编号"
      - name: ex_station_id
        display_name: 出口收费站编号
        data_type: string
        required: false
        description: "出口收费站编号"
      - name: en_lane_id
        display_name: 入口车道编号
        data_type: string
        required: false
        description: "入口车道编号"
      - name: ex_lane_id
        display_name: 出口车道编号
        data_type: string
        required: false
        description: "出口车道编号"

  # 保留原有的PathDetail和SplitDetail等（简化版）
  - name: PathDetail
    display_name: 车辆通行路径明细
    description: "车辆通行路径明细"
    data_source:
      connection_id: local_h2
      table: TBL_PATHDETAIL
      id_column: ID
      field_mapping:
        交易标识: ID
        通行标识: PASSID
        车牌号码: PLATENUM
        标识点标识: IDENTIFYPOINTID
        交易时间: TRANSTIME
        收费单元费用: FEE
    properties:
      - name: id
        display_name: 交易标识
        data_type: string
        required: true
        description: "交易标识"
      - name: pass_id
        display_name: 通行标识
        data_type: string
        required: false
        description: "通行标识"
      - name: plate_num
        display_name: 车牌号码
        data_type: string
        required: false
        description: "车牌号码"
      - name: identify_point_id
        display_name: 标识点标识
        data_type: string
        required: false
        description: "标识点标识"
      - name: trans_time
        display_name: 交易时间
        data_type: date
        required: false
        description: "交易时间"
      - name: fee
        display_name: 收费单元费用
        data_type: string
        required: false
        description: "收费单元费用"
    data_source:
      connection_id: local_h2
      table: TBL_PATHDETAIL
      id_column: ID
      field_mapping:
        交易标识: ID
        通行标识: PASSID
        车牌号码: PLATENUM
        标识点标识: IDENTIFYPOINTID
        交易时间: TRANSTIME
        收费单元费用: FEE

  # 收费拆分明细（事实表）
  - name: SplitDetail
    display_name: 收费拆分明细
    description: "按收费单元粒度拆分的收费明细记录（事实表）"
    # 数据源映射配置：从 H2 数据库读取数据
    data_source:
      connection_id: local_h2
      table: TBL_SPLITDETAIL
      id_column: pass_id
      field_mapping:
        通行ID: pass_id
        交易ID: transaction_id
        收费单元ID: interval_id
        区间通行费: toll_interval_fee
        区间应付费用: toll_interval_pay_fee
        区间优惠费用: toll_interval_discount_fee
        拆分标志: split_flag
        省拆分时间: pro_split_time
        省拆分类型: pro_split_type
        拆分备注: split_remark
    properties:
      - name: pass_id
        display_name: 通行ID
        data_type: string
        required: true
        description: "车辆通行唯一标识符，36字符"
        constraints:
          min_length: 36
          max_length: 36
      - name: transaction_id
        display_name: 交易ID
        data_type: string
        required: true
        description: "收费交易唯一标识符"
        constraints:
          min_length: 1
          max_length: 100
      - name: interval_id
        display_name: 收费单元ID
        data_type: string
        required: true
        description: "收费单元（门架区间）唯一标识，如 G000237008002120"
        constraints:
          min_length: 1
          max_length: 50
      - name: toll_interval_fee
        display_name: 区间通行费
        data_type: float
        required: true
        description: "该收费单元的通行费金额（元），优惠前"
        constraints:
          min: 0
      - name: toll_interval_pay_fee
        display_name: 区间应付费用
        data_type: float
        required: true
        description: "该收费单元的实际应付金额（元）"
        constraints:
          min: 0
      - name: toll_interval_discount_fee
        display_name: 区间优惠费用
        data_type: float
        required: true
        description: "该收费单元的优惠/折扣金额（元），正值表示优惠，负值表示加收"
      - name: split_flag
        display_name: 拆分标志
        data_type: int
        required: true
        description: "是否已进行拆分处理，1=已拆分，0=未拆分"
        constraints:
          min: 0
          max: 1
      - name: pro_split_time
        display_name: 省拆分时间
        data_type: datetime
        required: true
        description: "省级拆分处理的时间戳，格式：YYYY-MM-DD HH:MM:SS"
      - name: pro_split_type
        display_name: 省拆分类型
        data_type: int
        required: true
        description: "省级拆分处理类型，1=门架流水拆分"
        constraints:
          min: 1
      - name: split_remark
        display_name: 拆分备注
        data_type: string
        required: false
        description: "拆分处理的备注说明，如'门架流水作为拆分依据'"
        constraints:
          max_length: 200


# ============================================
# 关系定义（LinkType）
# ============================================

link_types:
  # ============================================
  # 实体间关系
  # ============================================
  
  # 收费站拥有车道
  - name: station_has_lanes
    display_name: 收费站拥有车道
    description: "收费站拥有多个车道"
    source_type: TollStation
    target_type: TollLane
    cardinality: one-to-many
    direction: directed
    data_source:
      connection_id: local_h2
      # 假设车道表中有station_id外键
      table: TOLL_LANES
      source_id_column: station_id
      target_id_column: lane_id
      link_mode: foreign_key
      field_mapping: {}

  # 车辆持有介质
  - name: vehicle_has_media
    display_name: 车辆持有通行介质
    description: "车辆持有通行介质（多对多关系）"
    source_type: Vehicle
    target_type: Media
    cardinality: many-to-many
    direction: undirected
    data_source:
      connection_id: local_h2
      # 使用中间表存储关系
      table: vehicle_media
      source_id_column: vehicle_id
      target_id_column: media_id
      link_mode: relation_table
      field_mapping: {}

  # ============================================
  # 交易与实体关系（事实表关联维度表）
  # ============================================
  
  # 入口交易发生在收费站
  - name: entry_at_station
    display_name: 入口交易发生在收费站
    description: "入口交易发生在收费站"
    source_type: EntryTransaction
    target_type: TollStation
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      # ID引用存储在entry_transactions表中，但不暴露为属性
      table: TBL_ENTRYWASTE
      source_id_column: EN_TOLL_STATION_ID  # 数据库列名
      target_id_column: station_id
      link_mode: foreign_key
      field_mapping: {}

  # 入口交易发生在车道
  - name: entry_at_lane
    display_name: 入口交易发生在车道
    description: "入口交易发生在车道"
    source_type: EntryTransaction
    target_type: TollLane
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_ENTRYWASTE
      source_id_column: EN_TOLL_LANE_ID
      target_id_column: lane_id
      link_mode: foreign_key
      field_mapping: {}

  # 入口交易由操作员处理
  - name: entry_handled_by
    display_name: 入口交易由操作员处理
    description: "入口交易由操作员处理"
    source_type: EntryTransaction
    target_type: Operator
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_ENTRYWASTE
      source_id_column: OPERID
      target_id_column: oper_id
      link_mode: foreign_key
      field_mapping: {}

  # 入口交易涉及车辆
  - name: entry_involves_vehicle
    display_name: 入口交易涉及车辆
    description: "入口交易涉及车辆"
    source_type: EntryTransaction
    target_type: Vehicle
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_ENTRYWASTE
      source_id_column: VEHICLEID  # 需要通过车牌号关联，这里简化处理
      target_id_column: vehicle_id
      link_mode: foreign_key
      field_mapping: {}

  # 入口交易使用介质
  - name: entry_uses_media
    display_name: 入口交易使用通行介质
    description: "入口交易使用通行介质"
    source_type: EntryTransaction
    target_type: Media
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_ENTRYWASTE
      source_id_column: MEDIAID
      target_id_column: media_id
      link_mode: foreign_key
      field_mapping: {}

  # 出口交易发生在收费站
  - name: exit_at_station
    display_name: 出口交易发生在收费站
    description: "出口交易发生在收费站"
    source_type: ExitTransaction
    target_type: TollStation
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_EXITWASTE
      source_id_column: EX_TOLL_STATION_ID
      target_id_column: station_id
      link_mode: foreign_key
      field_mapping: {}

  # 出口交易发生在车道
  - name: exit_at_lane
    display_name: 出口交易发生在车道
    description: "出口交易发生在车道"
    source_type: ExitTransaction
    target_type: TollLane
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_EXITWASTE
      source_id_column: EX_TOLL_LANE_ID
      target_id_column: lane_id
      link_mode: foreign_key
      field_mapping: {}

  # 出口交易由操作员处理
  - name: exit_handled_by
    display_name: 出口交易由操作员处理
    description: "出口交易由操作员处理"
    source_type: ExitTransaction
    target_type: Operator
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_EXITWASTE
      source_id_column: OPERID
      target_id_column: oper_id
      link_mode: foreign_key
      field_mapping: {}

  # 出口交易涉及车辆
  - name: exit_involves_vehicle
    display_name: 出口交易涉及车辆
    description: "出口交易涉及车辆"
    source_type: ExitTransaction
    target_type: Vehicle
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_EXITWASTE
      source_id_column: VEHICLEID
      target_id_column: vehicle_id
      link_mode: foreign_key
      field_mapping: {}

  # 门架交易发生在门架
  - name: gantry_at_gantry
    display_name: 门架交易发生在门架
    description: "门架交易发生在门架"
    source_type: GantryTransaction
    target_type: Gantry
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_GANTRYWASTE
      source_id_column: GANTRYID
      target_id_column: gantry_id
      link_mode: foreign_key
      field_mapping: {}

  # 门架交易涉及车辆
  - name: gantry_involves_vehicle
    display_name: 门架交易涉及车辆
    description: "门架交易涉及车辆"
    source_type: GantryTransaction
    target_type: Vehicle
    cardinality: many-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_GANTRYWASTE
      source_id_column: VEHICLEID
      target_id_column: vehicle_id
      link_mode: foreign_key
      field_mapping: {}

  # ============================================
  # 聚合关系（Passage聚合交易）
  # ============================================
  
  # 通行路径包含入口交易
  - name: passage_has_entry
    display_name: 通行路径包含入口交易
    description: "通行路径包含入口交易"
    source_type: Passage
    target_type: EntryTransaction
    cardinality: one-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_ENTRYWASTE
      source_id_column: PASSID
      target_id_column: pass_id
      link_mode: foreign_key
      field_mapping: {}

  # 通行路径包含出口交易
  - name: passage_has_exit
    display_name: 通行路径包含出口交易
    description: "通行路径包含出口交易"
    source_type: Passage
    target_type: ExitTransaction
    cardinality: one-to-one
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_EXITWASTE
      source_id_column: PASSID
      target_id_column: pass_id
      link_mode: foreign_key
      field_mapping: {}

  # 通行路径包含门架交易
  - name: passage_has_gantry_transactions
    display_name: 通行路径包含门架交易
    description: "通行路径包含多个门架交易"
    source_type: Passage
    target_type: GantryTransaction
    cardinality: one-to-many
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_GANTRYWASTE
      source_id_column: PASSID
      target_id_column: pass_id
      link_mode: foreign_key
      field_mapping: {}

  # 通行路径包含路径明细
  - name: passage_has_details
    display_name: 通行路径包含路径明细
    description: "通行路径包含多个路径明细"
    source_type: Passage
    target_type: PathDetail
    cardinality: one-to-many
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_PATHDETAIL
      source_id_column: PASSID
      target_id_column: ID
      link_mode: foreign_key
      field_mapping: {}

  # 通行路径包含拆分明细
  - name: passage_has_split_details
    display_name: 通行路径包含拆分明细
    description: "通行路径包含多个收费拆分明细"
    source_type: Passage
    target_type: SplitDetail
    cardinality: one-to-many
    direction: directed
    data_source:
      connection_id: local_h2
      table: TBL_SPLITDETAIL
      source_id_column: PASS_ID
      target_id_column: PASS_ID
      link_mode: foreign_key
      field_mapping: {}

  # 拆分明细关联收费单元（通过interval_id）
  - name: split_detail_at_interval
    display_name: 拆分明细关联收费单元
    description: "拆分明细关联到收费单元（门架区间）"
    source_type: SplitDetail
    target_type: Gantry
    cardinality: many-to-one
    direction: directed
    data_source:
      table: TBL_SPLITDETAIL
      source_id_column: interval_id
      target_id_column: gantry_id
      link_mode: foreign_key



version: "1.0"
namespace: "com.tollcenter.ontology.system"

object_types:
  - name: workspace
    display_name: 工作空间
    description: "用于对对象类型和关系类型进行分组的工作空间"
    properties:
      - name: name
        display_name: 工作空间标识
        data_type: string
        required: true
        description: "工作空间唯一标识（英文）"

      - name: display_name
        display_name: 工作空间名称
        data_type: string
        required: false
        description: "工作空间显示名称（中文）"

      - name: description
        display_name: 描述
        data_type: string
        required: false
        description: "工作空间用途说明"

      - name: object_types
        display_name: 对象类型列表
        data_type: json
        required: false
        description: "属于该工作空间的对象类型名称数组"

      - name: link_types
        display_name: 关系类型列表
        data_type: json
        required: false
        description: "属于该工作空间的关系类型名称数组"

  - name: database
    display_name: 数据源
    description: "数据库数据源"
    properties:
      - name: name
        display_name: 数据源名称
        data_type: string
        required: true
        description: "数据源唯一名称"
      
      - name: type
        display_name: 数据库类型
        data_type: string
        required: true
        description: "数据库类型（mysql、postgresql等）"
      
      - name: host
        display_name: 主机地址
        data_type: string
        required: true
        description: "数据库主机地址"
      
      - name: port
        display_name: 端口
        data_type: int
        required: true
        description: "数据库端口"
      
      - name: database_name
        display_name: 数据库名
        data_type: string
        required: true
        description: "数据库名称"
      
      - name: username
        display_name: 用户名
        data_type: string
        required: true
        description: "数据库用户名"
      
      - name: password
        display_name: 密码
        data_type: string
        required: false
        description: "数据库密码（加密存储）"
      
      - name: database_id
        display_name: 外部数据源ID
        data_type: string
        required: false
        description: "关联到外部ETL工具模块（dome-datasource）的数据源ID，用于ETL模型构建时的数据源映射"

  - name: table
    display_name: 数据表
    description: "数据库表"
    properties:
      - name: name
        display_name: 表名
        data_type: string
        required: true
        description: "数据库表名"
      
      - name: database_id
        display_name: 数据源ID
        data_type: string
        required: true
        description: "所属数据源的ID"
      
      - name: schema_name
        display_name: Schema名称
        data_type: string
        required: false
        description: "数据库Schema名称"
      
      - name: description
        display_name: 描述
        data_type: string
        required: false
        description: "表描述"

  - name: column
    display_name: 数据列
    description: "数据库表的列"
    properties:
      - name: name
        display_name: 列名
        data_type: string
        required: true
        description: "数据库列名"
      
      - name: table_id
        display_name: 表ID
        data_type: string
        required: true
        description: "所属表的ID"

      - name: table_name
        display_name: 表名
        data_type: string
        required: true
        description: "所属表的表名"
      
      - name: data_type
        display_name: 数据类型
        data_type: string
        required: true
        description: "数据库列的数据类型"
      
      - name: nullable
        display_name: 是否可空
        data_type: bool
        required: false
        description: "列是否允许为空"
      
      - name: is_primary_key
        display_name: 是否主键
        data_type: bool
        required: false
        description: "是否为主键"
      
      - name: description
        display_name: 描述
        data_type: string
        required: false
        description: "列描述"

  - name: mapping
    display_name: 映射关系
    description: "数据库表列与对象属性的映射关系"
    properties:
      - name: object_type
        display_name: 对象类型
        data_type: string
        required: true
        description: "目标对象类型名称"
      
      - name: table_id
        display_name: 表ID
        data_type: string
        required: true
        description: "源数据表ID"
      
      - name: table_name
        display_name: 表名
        data_type: string
        required: true
        description: "所属表的表名"
      
      - name: column_property_mappings
        display_name: 列属性映射
        data_type: json
        required: true
        description: "JSON格式的列到属性的映射关系，格式：{\"column_name\": \"property_name\"}"
      
      - name: primary_key_column
        display_name: 主键列
        data_type: string
        required: false
        description: "用于生成实例ID的主键列名"

  - name: AtomicMetric
    display_name: 原子指标
    description: "最小的可度量单元，由业务过程+统计方式组成，不可再分"
    properties:
      - name: id
        display_name: 原子指标ID
        data_type: string
        required: true
      
      - name: name
        display_name: 原子指标名称
        data_type: string
        required: true
        description: "业务过程+统计方式，如：交易金额、播放次数"
      
      - name: display_name
        display_name: 显示名称
        data_type: string
        required: false
      
      - name: description
        display_name: 描述
        data_type: string
        required: false
      
      - name: business_process
        display_name: 业务过程
        data_type: string
        required: true
        description: "业务过程对应的对象类型，如：EntryTransaction"
      
      - name: aggregation_function
        display_name: 统计方式
        data_type: string
        required: true
        description: "聚合函数，可选值: SUM, AVG, COUNT, MAX, MIN, DISTINCT_COUNT"
      
      - name: aggregation_field
        display_name: 度量字段
        data_type: string
        required: false
        description: "用于聚合的字段名（COUNT时可为空）"
      
      - name: unit
        display_name: 单位
        data_type: string
        required: false
        description: "原子指标单位（如: 元、个、次）"
      
      - name: status
        display_name: 状态
        data_type: string
        required: true
        description: "可选值: active, inactive, deprecated"

  - name: MetricDefinition
    display_name: 指标定义
    description: "业务指标的定义，包括派生指标和复合指标"
    properties:
      - name: id
        display_name: 指标ID
        data_type: string
        required: true
      
      - name: name
        display_name: 指标名称
        data_type: string
        required: true
        description: "自动生成：时间周期+原子指标名称"
      
      - name: display_name
        display_name: 显示名称
        data_type: string
        required: false
      
      - name: description
        display_name: 描述
        data_type: string
        required: false
      
      - name: metric_type
        display_name: 指标类型
        data_type: string
        required: true
        description: "可选值: derived（派生指标）, composite（复合指标）"
      
      - name: atomic_metric_id
        display_name: 原子指标ID
        data_type: string
        required: false
        description: "引用的原子指标ID（派生指标必须）"
      
      - name: business_scope
        display_name: 业务范围
        data_type: json
        required: false
        description: "业务范围配置，确定统计的业务范围。单模型或多模型配置"
      
      - name: time_dimension
        display_name: 时间维度
        data_type: string
        required: false
        description: "时间维度字段名（如: l_date, create_time）"
      
      - name: time_granularity
        display_name: 时间粒度
        data_type: string
        required: false
        description: "时间统计粒度，可选值: day, week, month, quarter, year"
      
      - name: dimensions
        display_name: 维度
        data_type: json
        required: false
        description: "观察视角（维度字段列表），用于多维度分析，不参与指标命名。JSON格式: [\"field1\", \"field2\"]"
      
      - name: filter_conditions
        display_name: 条件限定
        data_type: json
        required: false
        description: "条件限定（过滤条件），用于灵活剪裁数据，不参与指标命名。JSON格式: {\"field\": \"value\"}"
      
      - name: comparison_type
        display_name: 对比类型
        data_type: json
        required: false
        description: "对比指标类型列表，可选值: YoY (同比), MoM (环比), WoW (环比周), QoQ (环比季度)"
      
      - name: derived_formula
        display_name: 衍生公式
        data_type: string
        required: false
        description: "衍生指标的计算公式（如: {metric1} / {metric2}）"
      
      - name: base_metric_ids
        display_name: 基础指标ID列表
        data_type: json
        required: false
        description: "衍生指标依赖的基础指标ID列表，JSON格式: [\"metric_id1\", \"metric_id2\"]"
      
      - name: unit
        display_name: 单位
        data_type: string
        required: false
        description: "指标单位（如: 元、个、次）"
      
      - name: status
        display_name: 状态
        data_type: string
        required: true
        description: "可选值: active, inactive, deprecated"

link_types:
  - name: database_has_table
    display_name: 数据源包含表
    description: "数据源包含数据表"
    source_type: database
    target_type: table
    cardinality: one-to-many
    direction: directed
    property_mappings:
      id: database_id

  - name: table_has_column
    display_name: 表包含列
    description: "数据表包含列"
    source_type: table
    target_type: column
    cardinality: one-to-many
    direction: directed
    property_mappings:
      id: table_id

  - name: mapping_links_table
    display_name: 映射关联表
    description: "映射关系关联到数据表"
    source_type: mapping
    target_type: table
    cardinality: many-to-one
    direction: directed

  - name: derived_uses_atomic
    display_name: 派生指标引用原子指标
    description: "派生指标基于原子指标构建"
    source_type: MetricDefinition
    target_type: AtomicMetric
    cardinality: many-to-one
    direction: directed
    property_mappings:
      atomic_metric_id: id
  
  - name: composite_depends_on
    display_name: 复合指标依赖
    description: "复合指标依赖的基础指标（派生指标或复合指标）"
    source_type: MetricDefinition
    target_type: MetricDefinition
    cardinality: many-to-many
    direction: directed
    property_mappings:
      base_metric_ids: id

  - name: atomic_metric_belongs_to_workspace
    display_name: 原子指标归属工作空间
    description: "原子指标归属于一个或多个工作空间（模型）"
    source_type: AtomicMetric
    target_type: workspace
    cardinality: many-to-many
    direction: directed

  - name: metric_definition_belongs_to_workspace
    display_name: 业务指标归属工作空间
    description: "业务指标（派生指标或复合指标）归属于一个或多个工作空间（模型）"
    source_type: MetricDefinition
    target_type: workspace
    cardinality: many-to-many
    direction: directed
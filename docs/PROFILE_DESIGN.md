# ç”»åƒåŠŸèƒ½è®¾è®¡æ–¹æ¡ˆ

## ä¸€ã€è®¾è®¡èƒŒæ™¯ä¸å®šä½

### 1.1 æ ¸å¿ƒç†å¿µ

ç”»åƒåŠŸèƒ½æ˜¯åŸºäºç°æœ‰**æŒ‡æ ‡ä½“ç³»**çš„é«˜çº§åº”ç”¨å±‚ï¼Œæœ¬è´¨ä¸Šæ˜¯**å¤šç»´åº¦æŒ‡æ ‡èšåˆç»“æœçš„å¯è§†åŒ–æŠ¥è¡¨**ã€‚åœ¨ MyPalantir çš„ Ontology é©±åŠ¨æ¶æ„ä¸‹ï¼Œç”»åƒä¸æ˜¯ç‹¬ç«‹çš„æ•°æ®å±‚ï¼Œè€Œæ˜¯æŒ‡æ ‡è®¡ç®—ç»“æœçš„ç»„ç»‡å’Œå±•ç¤ºå½¢å¼ã€‚

```
ã€æ•°æ®åˆ†å±‚æ¶æ„ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”»åƒå±‚ (Profile Layer)                  â”‚  â† æŠ¥è¡¨å±•ç¤ºå±‚
â”‚  - é—¨æ¶ç”»åƒã€è½¦è¾†ç”»åƒ                     â”‚
â”‚  - åŸºäºæŒ‡æ ‡ç»„åˆ + å¯è§†åŒ–                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŒ‡æ ‡å±‚ (Metric Layer)                   â”‚  â† å·²æœ‰èƒ½åŠ›
â”‚  - åŸå­æŒ‡æ ‡ã€æ´¾ç”ŸæŒ‡æ ‡ã€å¤åˆæŒ‡æ ‡            â”‚
â”‚  - èšåˆè®¡ç®—ã€æ—¶é—´ç²’åº¦ã€ç»´åº¦åˆ†æ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘ æŸ¥è¯¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äº‹å®å±‚ (Fact Layer)                     â”‚  â† æ•°æ®æº
â”‚  - EntryTransaction å…¥å£äº¤æ˜“              â”‚
â”‚  - ExitTransaction å‡ºå£äº¤æ˜“               â”‚
â”‚  - GantryTransaction é—¨æ¶äº¤æ˜“             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä¸šåŠ¡ä»·å€¼

**é—¨æ¶ç”»åƒ**ï¼š
- è¯†åˆ«é«˜ä»·å€¼é—¨æ¶ï¼ˆæ”¶å…¥è´¡çŒ®åº¦ï¼‰
- åˆ†ææµé‡åˆ†å¸ƒå’Œç¹å¿™æ—¶æ®µ
- ä¼˜åŒ–èµ„æºé…ç½®å’Œè¿è¥ç­–ç•¥
- å¼‚å¸¸æ£€æµ‹ï¼ˆæµé‡çªé™ã€æ•…éšœé¢„è­¦ï¼‰

**è½¦è¾†ç”»åƒ**ï¼š
- ç”¨æˆ·åˆ†å±‚ï¼ˆé«˜é¢‘/ä½é¢‘ç”¨æˆ·ï¼‰
- è¡Œä¸ºåˆ†æï¼ˆå¸¸ç”¨è·¯çº¿ã€å‡ºè¡Œä¹ æƒ¯ï¼‰
- ç²¾å‡†è¥é”€å’Œå®šä»·ç­–ç•¥
- é£é™©è¯†åˆ«ï¼ˆå¼‚å¸¸é€šè¡Œè¡Œä¸ºï¼‰

---

## äºŒã€æŠ€æœ¯æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯å±•ç¤ºå±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ é—¨æ¶ç”»åƒé¡µé¢  â”‚  â”‚ è½¦è¾†ç”»åƒé¡µé¢  â”‚  â”‚ ç”»åƒå¯¹æ¯”é¡µé¢  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯æœåŠ¡å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ProfileService (ç”»åƒæœåŠ¡)                       â”‚     â”‚
â”‚  â”‚  - generateProfile()    ç”Ÿæˆç”»åƒ                 â”‚     â”‚
â”‚  â”‚  - getProfileMetrics()  è·å–æŒ‡æ ‡ç»„åˆ             â”‚     â”‚
â”‚  â”‚  - compareProfiles()    ç”»åƒå¯¹æ¯”                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                         â†“ è°ƒç”¨                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  MetricService (æŒ‡æ ‡æœåŠ¡) - å·²æœ‰                 â”‚     â”‚
â”‚  â”‚  - calculateAtomicMetric()   è®¡ç®—åŸå­æŒ‡æ ‡        â”‚     â”‚
â”‚  â”‚  - calculateMetric()         è®¡ç®—æ´¾ç”Ÿ/å¤åˆæŒ‡æ ‡   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                         â†“ è°ƒç”¨                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  QueryService (æŸ¥è¯¢æœåŠ¡) - å·²æœ‰                  â”‚     â”‚
â”‚  â”‚  - executeQuery()            æ‰§è¡Œ OntologyQuery â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ SQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®å­˜å‚¨å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ äº¤æ˜“äº‹å®è¡¨    â”‚  â”‚ æŒ‡æ ‡å®šä¹‰å­˜å‚¨  â”‚  â”‚ ç”»åƒç¼“å­˜è¡¨    â”‚   â”‚
â”‚  â”‚ (å·²æœ‰)       â”‚  â”‚ (å·²æœ‰)       â”‚  â”‚ (å¯é€‰)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **å¤ç”¨ä¼˜å…ˆ**ï¼šå……åˆ†åˆ©ç”¨ç°æœ‰æŒ‡æ ‡è®¡ç®—èƒ½åŠ›ï¼Œé¿å…é‡å¤å¼€å‘
2. **è½»é‡å®ç°**ï¼šç”»åƒä¸å¼•å…¥æ–°çš„æ•°æ®æ¨¡å‹ï¼Œä»…ä½œä¸ºæŒ‡æ ‡ç»„åˆçš„å±•ç¤ºå½¢å¼
3. **çµæ´»é…ç½®**ï¼šç”»åƒç»´åº¦å’ŒæŒ‡æ ‡ç»„åˆå¯é…ç½®ï¼Œæ”¯æŒä¸šåŠ¡è¿­ä»£
4. **æŒ‰éœ€ç¼“å­˜**ï¼šåˆæœŸå®æ—¶è®¡ç®—ï¼Œæ€§èƒ½ç“¶é¢ˆæ—¶å†å¼•å…¥ç¼“å­˜æœºåˆ¶

---

## ä¸‰ã€å®ç°æ–¹æ¡ˆ

### 3.1 æ–¹æ¡ˆé€‰æ‹©

#### **æ–¹æ¡ˆAï¼šè½»é‡çº§å®ç°ï¼ˆæ¨èé¦–é€‰ï¼‰**

**è®¾è®¡æ€è·¯**ï¼š
- ç”»åƒ = å‰ç«¯å‘èµ·å¤šä¸ªæŒ‡æ ‡æŸ¥è¯¢ â†’ å¹¶å‘è¯·æ±‚ â†’ ç»„è£…ç»“æœ â†’ å¯è§†åŒ–å±•ç¤º
- ä¸æ–°å¢æ•°æ®è¡¨ï¼Œä¸ä¿®æ”¹ Schemaï¼Œçº¯åº”ç”¨å±‚å®ç°

**ä¼˜åŠ¿**ï¼š
- âœ… å®ç°å¿«é€Ÿï¼Œæ— éœ€æ•°æ®å»ºæ¨¡
- âœ… æ•°æ®å®æ—¶ï¼Œæ— å»¶è¿Ÿ
- âœ… æ¶æ„ç®€æ´ï¼Œæ˜“äºç»´æŠ¤

**é€‚ç”¨åœºæ™¯**ï¼š
- ç”»åƒè®¿é—®é¢‘ç‡ä¸é«˜ï¼ˆ< 100 QPSï¼‰
- åº•å±‚æ•°æ®é‡å¯æ§ï¼ˆå•æ¬¡æŸ¥è¯¢ < 1sï¼‰
- å¿«é€ŸéªŒè¯ä¸šåŠ¡ä»·å€¼

---

#### **æ–¹æ¡ˆBï¼šé¢„è®¡ç®—ç¼“å­˜ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰**

**è®¾è®¡æ€è·¯**ï¼š
- åç«¯å®šæ—¶ä»»åŠ¡æ‰¹é‡è®¡ç®—ç”»åƒ â†’ å­˜å‚¨åˆ°ç¼“å­˜è¡¨ â†’ å‰ç«¯è¯»å–ç¼“å­˜

**ä¼˜åŠ¿**ï¼š
- âœ… æŸ¥è¯¢æ€§èƒ½é«˜ï¼ˆç›´æ¥è¯»ç¼“å­˜ï¼‰
- âœ… æ”¯æŒå†å²ç”»åƒå¯¹æ¯”
- âœ… é™ä½æ•°æ®åº“å‹åŠ›

**æ–°å¢æ•°æ®è¡¨**ï¼š
```sql
-- é€šç”¨ç”»åƒç¼“å­˜è¡¨
CREATE TABLE PROFILE_CACHE (
    id VARCHAR(36) PRIMARY KEY,
    entity_type VARCHAR(50) NOT NULL,     -- Gantry/Vehicle/TollStation
    entity_id VARCHAR(50) NOT NULL,       -- å®ä½“ID
    profile_type VARCHAR(50) NOT NULL,    -- daily/weekly/monthly
    profile_date DATE NOT NULL,           -- ç”»åƒæ—¥æœŸ
    metrics_json TEXT NOT NULL,           -- JSONæ ¼å¼å­˜å‚¨æ‰€æœ‰æŒ‡æ ‡
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(entity_type, entity_id, profile_type, profile_date)
);

CREATE INDEX idx_profile_entity ON PROFILE_CACHE(entity_type, entity_id, profile_date);
```

**é€‚ç”¨åœºæ™¯**ï¼š
- ç”»åƒè®¿é—®é¢‘ç‡é«˜
- éœ€è¦å†å²ç”»åƒè¶‹åŠ¿åˆ†æ
- åº•å±‚æ•°æ®é‡å¤§ï¼Œå®æ—¶è®¡ç®—æ…¢

---

### 3.2 æ–¹æ¡ˆAè¯¦ç»†è®¾è®¡ï¼ˆè½»é‡çº§å®ç°ï¼‰

#### **3.2.1 åç«¯æ¥å£è®¾è®¡**

##### **API æ¥å£å®šä¹‰**

```java
// src/main/java/com/mypalantir/controller/ProfileController.java
package com.mypalantir.controller;

@RestController
@RequestMapping("/api/v1/profiles")
public class ProfileController {
    
    private final ProfileService profileService;
    
    /**
     * è·å–é—¨æ¶ç”»åƒ
     * @param gantryId é—¨æ¶ID
     * @param startDate å¼€å§‹æ—¥æœŸ
     * @param endDate ç»“æŸæ—¥æœŸ
     * @return ç”»åƒæ•°æ®
     */
    @GetMapping("/gantry/{gantryId}")
    public ApiResponse<GantryProfileData> getGantryProfile(
        @PathVariable String gantryId,
        @RequestParam(defaultValue = "2024-01-01") String startDate,
        @RequestParam(defaultValue = "2024-12-31") String endDate
    ) {
        GantryProfileData profile = profileService.generateGantryProfile(
            gantryId, 
            LocalDate.parse(startDate), 
            LocalDate.parse(endDate)
        );
        return ApiResponse.success(profile);
    }
    
    /**
     * è·å–è½¦è¾†ç”»åƒ
     */
    @GetMapping("/vehicle/{vehicleId}")
    public ApiResponse<VehicleProfileData> getVehicleProfile(
        @PathVariable String vehicleId,
        @RequestParam(defaultValue = "2024-01-01") String startDate,
        @RequestParam(defaultValue = "2024-12-31") String endDate
    ) {
        VehicleProfileData profile = profileService.generateVehicleProfile(
            vehicleId,
            LocalDate.parse(startDate),
            LocalDate.parse(endDate)
        );
        return ApiResponse.success(profile);
    }
    
    /**
     * æ‰¹é‡è·å–é—¨æ¶ç”»åƒï¼ˆç”¨äºå¯¹æ¯”ï¼‰
     */
    @PostMapping("/gantry/batch")
    public ApiResponse<List<GantryProfileData>> batchGetGantryProfiles(
        @RequestBody BatchProfileRequest request
    ) {
        List<GantryProfileData> profiles = profileService.batchGenerateGantryProfiles(
            request.getGantryIds(),
            LocalDate.parse(request.getStartDate()),
            LocalDate.parse(request.getEndDate())
        );
        return ApiResponse.success(profiles);
    }
}
```

##### **æ•°æ®ä¼ è¾“å¯¹è±¡ (DTO)**

```java
// src/main/java/com/mypalantir/dto/GantryProfileData.java
package com.mypalantir.dto;

@Data
public class GantryProfileData {
    // åŸºç¡€ä¿¡æ¯
    private String gantryId;
    private String gantryHex;
    private String gantryName;
    
    // æ—¶é—´èŒƒå›´
    private String startDate;
    private String endDate;
    private Integer totalDays;
    
    // æ ¸å¿ƒæŒ‡æ ‡
    private Long totalTransactionCount;      // æ€»äº¤æ˜“é‡
    private Double totalRevenue;             // æ€»æ”¶å…¥(å…ƒ)
    private Double avgDailyRevenue;          // æ—¥å‡æ”¶å…¥
    private Double avgTransactionAmount;     // å¹³å‡å•ç¬”é‡‘é¢
    
    // æ—¶é—´åˆ†å¸ƒ
    private Map<String, Integer> hourlyDistribution;  // å°æ—¶åˆ†å¸ƒ
    private String peakHour;                          // é«˜å³°æ—¶æ®µ
    private String peakHourCount;                     // é«˜å³°æ—¶æ®µäº¤æ˜“é‡
    
    // è½¦å‹åˆ†å¸ƒ
    private Map<String, VehicleTypeStats> vehicleTypeDistribution;
    
    // ç¹å¿™åº¦è¯„çº§
    private String busyLevel;  // LOW/MEDIUM/HIGH
    private Double busyScore;  // 0-100 åˆ†å€¼
    
    // è¶‹åŠ¿æ•°æ®ï¼ˆå¯é€‰ï¼‰
    private List<DailyTrendData> dailyTrends;
}

@Data
class VehicleTypeStats {
    private String vehicleType;
    private Integer count;
    private Double percentage;
    private Double totalFee;
}

@Data
class DailyTrendData {
    private String date;
    private Integer transactionCount;
    private Double revenue;
}
```

```java
// src/main/java/com/mypalantir/dto/VehicleProfileData.java
package com.mypalantir.dto;

@Data
public class VehicleProfileData {
    // åŸºç¡€ä¿¡æ¯
    private String vehicleId;
    private String plateNum;
    private String plateColor;
    private Integer vehicleType;
    
    // æ—¶é—´èŒƒå›´
    private String startDate;
    private String endDate;
    
    // é€šè¡Œç»Ÿè®¡
    private Integer totalTrips;              // æ€»é€šè¡Œæ¬¡æ•°
    private Long totalDistance;              // ç´¯è®¡é‡Œç¨‹(ç±³)
    private Double totalFee;                 // ç´¯è®¡è´¹ç”¨(å…ƒ)
    private Double avgTripDistance;          // å¹³å‡å•æ¬¡é‡Œç¨‹
    private Double avgTripFee;               // å¹³å‡å•æ¬¡è´¹ç”¨
    
    // å¸¸ç”¨è·¯çº¿
    private List<FrequentRoute> frequentRoutes;
    
    // å¸¸ç”¨æ”¶è´¹ç«™
    private List<FrequentStation> frequentStations;
    
    // æ´»è·ƒæ—¶æ®µ
    private Map<String, Integer> activityPattern;  // å°æ—¶ -> æ¬¡æ•°
    private String mostActiveHour;
    
    // ç”¨æˆ·åˆ†ç±»
    private String userType;  // HIGH_FREQ/MEDIUM_FREQ/LOW_FREQ
    private Double activityScore;  // æ´»è·ƒåº¦åˆ†å€¼
    
    // è¶‹åŠ¿æ•°æ®
    private List<MonthlyTrendData> monthlyTrends;
}

@Data
class FrequentRoute {
    private String entryStation;
    private String exitStation;
    private Integer tripCount;
    private Double percentage;
}

@Data
class FrequentStation {
    private String stationId;
    private String stationName;
    private Integer usageCount;
    private Double percentage;
}
```

---

#### **3.2.2 ä¸šåŠ¡é€»è¾‘å®ç°**

```java
// src/main/java/com/mypalantir/service/ProfileService.java
package com.mypalantir.service;

@Service
public class ProfileService {
    
    private final MetricCalculator metricCalculator;
    private final AtomicMetricService atomicMetricService;
    private final MetricService metricService;
    private final QueryService queryService;
    private final Loader loader;
    
    /**
     * ç”Ÿæˆé—¨æ¶ç”»åƒ
     */
    public GantryProfileData generateGantryProfile(
        String gantryId, 
        LocalDate startDate, 
        LocalDate endDate
    ) throws Exception {
        GantryProfileData profile = new GantryProfileData();
        
        // 1. è·å–é—¨æ¶åŸºç¡€ä¿¡æ¯
        Gantry gantry = getGantryInfo(gantryId);
        profile.setGantryId(gantryId);
        profile.setGantryHex(gantry.getGantryHex());
        profile.setStartDate(startDate.toString());
        profile.setEndDate(endDate.toString());
        
        // 2. è®¡ç®—æ ¸å¿ƒæŒ‡æ ‡ - ä½¿ç”¨ç°æœ‰æŒ‡æ ‡ç³»ç»Ÿ
        // 2.1 æ€»äº¤æ˜“é‡
        MetricQuery countQuery = buildMetricQuery(startDate, endDate, gantryId);
        MetricResult countResult = calculateAtomicMetric("gantry_transaction_count", countQuery);
        profile.setTotalTransactionCount(extractValue(countResult, Long.class));
        
        // 2.2 æ€»æ”¶å…¥
        MetricResult revenueResult = calculateAtomicMetric("gantry_total_revenue", countQuery);
        profile.setTotalRevenue(extractValue(revenueResult, Double.class));
        
        // 2.3 å¹³å‡é‡‘é¢
        MetricResult avgResult = calculateAtomicMetric("gantry_avg_amount", countQuery);
        profile.setAvgTransactionAmount(extractValue(avgResult, Double.class));
        
        // 3. æ—¶é—´åˆ†å¸ƒåˆ†æ - ä½¿ç”¨ OntologyQuery èšåˆ
        Map<String, Integer> hourlyDist = calculateHourlyDistribution(gantryId, startDate, endDate);
        profile.setHourlyDistribution(hourlyDist);
        profile.setPeakHour(findPeakHour(hourlyDist));
        
        // 4. è½¦å‹åˆ†å¸ƒåˆ†æ
        Map<String, VehicleTypeStats> vehicleDist = calculateVehicleTypeDistribution(
            gantryId, startDate, endDate
        );
        profile.setVehicleTypeDistribution(vehicleDist);
        
        // 5. ç¹å¿™åº¦è¯„çº§
        BusyLevel busyLevel = calculateBusyLevel(profile.getTotalTransactionCount(), endDate.toEpochDay() - startDate.toEpochDay());
        profile.setBusyLevel(busyLevel.getLevel());
        profile.setBusyScore(busyLevel.getScore());
        
        return profile;
    }
    
    /**
     * è®¡ç®—å°æ—¶åˆ†å¸ƒ
     */
    private Map<String, Integer> calculateHourlyDistribution(
        String gantryId, 
        LocalDate startDate, 
        LocalDate endDate
    ) throws Exception {
        // æ„å»º OntologyQuery - æŒ‰å°æ—¶åˆ†ç»„
        Map<String, Object> query = Map.of(
            "object", "GantryTransaction",
            "filter", List.of(
                List.of("=", "gantry_id", gantryId),
                List.of(">=", "trans_time", startDate.toString()),
                List.of("<=", "trans_time", endDate.toString())
            ),
            "select", List.of("trans_time"),
            "metrics", List.of(
                List.of("count", "*", "count")
            )
        );
        
        QueryExecutor.QueryResult result = queryService.executeQuery(query);
        
        // å¤„ç†ç»“æœï¼Œæå–å°æ—¶å¹¶èšåˆ
        Map<String, Integer> hourlyMap = new HashMap<>();
        for (Map<String, Object> row : result.getRows()) {
            String timeStr = (String) row.get("trans_time");
            String hour = extractHour(timeStr);  // æå–å°æ—¶éƒ¨åˆ†
            Integer count = (Integer) row.get("count");
            hourlyMap.merge(hour, count, Integer::sum);
        }
        
        return hourlyMap;
    }
    
    /**
     * è®¡ç®—è½¦å‹åˆ†å¸ƒ
     */
    private Map<String, VehicleTypeStats> calculateVehicleTypeDistribution(
        String gantryId,
        LocalDate startDate,
        LocalDate endDate
    ) throws Exception {
        Map<String, Object> query = Map.of(
            "object", "GantryTransaction",
            "filter", List.of(
                List.of("=", "gantry_id", gantryId),
                List.of(">=", "trans_time", startDate.toString()),
                List.of("<=", "trans_time", endDate.toString())
            ),
            "groupBy", List.of("snapshot_vehicle_type"),
            "metrics", List.of(
                List.of("count", "*", "count"),
                List.of("sum", "fee", "total_fee")
            )
        );
        
        QueryExecutor.QueryResult result = queryService.executeQuery(query);
        
        // è®¡ç®—æ€»é‡ï¼ˆç”¨äºç™¾åˆ†æ¯”ï¼‰
        long totalCount = result.getRows().stream()
            .mapToLong(r -> ((Number) r.get("count")).longValue())
            .sum();
        
        Map<String, VehicleTypeStats> distribution = new HashMap<>();
        for (Map<String, Object> row : result.getRows()) {
            String vehicleType = String.valueOf(row.get("snapshot_vehicle_type"));
            Integer count = ((Number) row.get("count")).intValue();
            Double totalFee = ((Number) row.get("total_fee")).doubleValue() / 100;
            
            VehicleTypeStats stats = new VehicleTypeStats();
            stats.setVehicleType(vehicleType);
            stats.setCount(count);
            stats.setPercentage(count * 100.0 / totalCount);
            stats.setTotalFee(totalFee);
            
            distribution.put(vehicleType, stats);
        }
        
        return distribution;
    }
    
    /**
     * è®¡ç®—ç¹å¿™åº¦ç­‰çº§
     */
    private BusyLevel calculateBusyLevel(Long totalCount, long days) {
        double avgDaily = totalCount / (double) days;
        
        // ç¹å¿™åº¦è¯„åˆ†è§„åˆ™ï¼ˆå¯é…ç½®ï¼‰
        double score;
        String level;
        
        if (avgDaily < 100) {
            level = "LOW";
            score = (avgDaily / 100) * 33;
        } else if (avgDaily < 500) {
            level = "MEDIUM";
            score = 33 + ((avgDaily - 100) / 400) * 34;
        } else {
            level = "HIGH";
            score = 67 + Math.min(((avgDaily - 500) / 500) * 33, 33);
        }
        
        return new BusyLevel(level, score);
    }
    
    /**
     * ç”Ÿæˆè½¦è¾†ç”»åƒ
     */
    public VehicleProfileData generateVehicleProfile(
        String vehicleId,
        LocalDate startDate,
        LocalDate endDate
    ) throws Exception {
        // å®ç°é€»è¾‘ç±»ä¼¼é—¨æ¶ç”»åƒ
        // åŸºäº ExitTransaction èšåˆåˆ†æ
        // ...
    }
}

@Data
@AllArgsConstructor
class BusyLevel {
    private String level;
    private Double score;
}
```

---

#### **3.2.3 å‰ç«¯é¡µé¢å®ç°**

##### **é—¨æ¶ç”»åƒé¡µé¢**

```typescript
// web/src/pages/GantryProfileView.tsx
import React, { useState, useEffect } from 'react';
import { profileApi } from '../api/profile';
import { schemaApi } from '../api/client';

interface GantryProfileData {
  gantryId: string;
  gantryHex: string;
  startDate: string;
  endDate: string;
  totalTransactionCount: number;
  totalRevenue: number;
  avgDailyRevenue: number;
  avgTransactionAmount: number;
  hourlyDistribution: Record<string, number>;
  peakHour: string;
  vehicleTypeDistribution: Record<string, VehicleTypeStats>;
  busyLevel: string;
  busyScore: number;
}

const GantryProfileView: React.FC = () => {
  const [gantries, setGantries] = useState<any[]>([]);
  const [selectedGantryId, setSelectedGantryId] = useState<string>('');
  const [startDate, setStartDate] = useState<string>('2024-01-01');
  const [endDate, setEndDate] = useState<string>('2024-12-31');
  const [profile, setProfile] = useState<GantryProfileData | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // åŠ è½½é—¨æ¶åˆ—è¡¨
  useEffect(() => {
    loadGantries();
  }, []);

  const loadGantries = async () => {
    try {
      const instances = await schemaApi.getInstances('Gantry');
      setGantries(instances);
      if (instances.length > 0) {
        setSelectedGantryId(instances[0].id);
      }
    } catch (err) {
      console.error('Failed to load gantries:', err);
    }
  };

  // åŠ è½½ç”»åƒ
  const loadProfile = async () => {
    if (!selectedGantryId) return;
    
    setLoading(true);
    setError(null);
    try {
      const data = await profileApi.getGantryProfile(
        selectedGantryId,
        startDate,
        endDate
      );
      setProfile(data);
    } catch (err: any) {
      setError(err.message || 'åŠ è½½ç”»åƒå¤±è´¥');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="container mx-auto p-6">
      <h1 className="text-3xl font-bold mb-6">é—¨æ¶ç”»åƒåˆ†æ</h1>

      {/* æŸ¥è¯¢æ¡ä»¶ */}
      <div className="bg-white rounded-lg shadow p-6 mb-6">
        <div className="grid grid-cols-4 gap-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              é€‰æ‹©é—¨æ¶
            </label>
            <select
              value={selectedGantryId}
              onChange={(e) => setSelectedGantryId(e.target.value)}
              className="w-full p-2 border rounded"
            >
              <option value="">è¯·é€‰æ‹©é—¨æ¶</option>
              {gantries.map(g => (
                <option key={g.id} value={g.id}>
                  {g.properties.gantry_hex || g.id}
                </option>
              ))}
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              å¼€å§‹æ—¥æœŸ
            </label>
            <input
              type="date"
              value={startDate}
              onChange={(e) => setStartDate(e.target.value)}
              className="w-full p-2 border rounded"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ç»“æŸæ—¥æœŸ
            </label>
            <input
              type="date"
              value={endDate}
              onChange={(e) => setEndDate(e.target.value)}
              className="w-full p-2 border rounded"
            />
          </div>
          <div className="flex items-end">
            <button
              onClick={loadProfile}
              disabled={loading || !selectedGantryId}
              className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-400"
            >
              {loading ? 'åŠ è½½ä¸­...' : 'æŸ¥çœ‹ç”»åƒ'}
            </button>
          </div>
        </div>
      </div>

      {/* é”™è¯¯æç¤º */}
      {error && (
        <div className="bg-red-50 border border-red-200 rounded p-4 mb-6">
          <p className="text-red-800">{error}</p>
        </div>
      )}

      {/* ç”»åƒå±•ç¤º */}
      {profile && (
        <div className="space-y-6">
          {/* æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ */}
          <div className="grid grid-cols-4 gap-4">
            <MetricCard
              title="æ€»äº¤æ˜“é‡"
              value={profile.totalTransactionCount.toLocaleString()}
              unit="ç¬”"
              icon="ğŸ“Š"
            />
            <MetricCard
              title="æ€»æ”¶å…¥"
              value={profile.totalRevenue.toLocaleString()}
              unit="å…ƒ"
              icon="ğŸ’°"
            />
            <MetricCard
              title="å¹³å‡å•ç¬”é‡‘é¢"
              value={profile.avgTransactionAmount.toFixed(2)}
              unit="å…ƒ"
              icon="ğŸ’³"
            />
            <MetricCard
              title="ç¹å¿™åº¦"
              value={profile.busyLevel}
              subtitle={`è¯„åˆ†: ${profile.busyScore.toFixed(1)}`}
              icon="ğŸ”¥"
              levelColor={getBusyLevelColor(profile.busyLevel)}
            />
          </div>

          {/* æ—¶é—´åˆ†å¸ƒå›¾è¡¨ */}
          <div className="bg-white rounded-lg shadow p-6">
            <h2 className="text-xl font-semibold mb-4">24å°æ—¶äº¤æ˜“åˆ†å¸ƒ</h2>
            <HourlyDistributionChart data={profile.hourlyDistribution} />
            <p className="text-sm text-gray-600 mt-2">
              é«˜å³°æ—¶æ®µ: {profile.peakHour}
            </p>
          </div>

          {/* è½¦å‹åˆ†å¸ƒ */}
          <div className="bg-white rounded-lg shadow p-6">
            <h2 className="text-xl font-semibold mb-4">è½¦å‹åˆ†å¸ƒ</h2>
            <VehicleTypeDistributionChart 
              data={profile.vehicleTypeDistribution} 
            />
          </div>
        </div>
      )}
    </div>
  );
};

// æŒ‡æ ‡å¡ç‰‡ç»„ä»¶
const MetricCard: React.FC<{
  title: string;
  value: string;
  unit?: string;
  subtitle?: string;
  icon?: string;
  levelColor?: string;
}> = ({ title, value, unit, subtitle, icon, levelColor }) => (
  <div className="bg-white rounded-lg shadow p-6">
    <div className="flex items-center justify-between mb-2">
      <span className="text-sm text-gray-600">{title}</span>
      {icon && <span className="text-2xl">{icon}</span>}
    </div>
    <div className="flex items-baseline">
      <span 
        className={`text-3xl font-bold ${levelColor || 'text-gray-900'}`}
      >
        {value}
      </span>
      {unit && <span className="ml-2 text-gray-600">{unit}</span>}
    </div>
    {subtitle && (
      <p className="text-xs text-gray-500 mt-1">{subtitle}</p>
    )}
  </div>
);

// å°æ—¶åˆ†å¸ƒå›¾è¡¨ç»„ä»¶ï¼ˆä½¿ç”¨ rechartsï¼‰
const HourlyDistributionChart: React.FC<{
  data: Record<string, number>;
}> = ({ data }) => {
  const chartData = Object.entries(data).map(([hour, count]) => ({
    hour: `${hour}:00`,
    count,
  }));

  return (
    <div className="h-64">
      {/* ä½¿ç”¨ recharts BarChart å®ç° */}
      <p className="text-sm text-gray-500">
        å›¾è¡¨å±•ç¤ºï¼š{chartData.length} ä¸ªæ—¶æ®µæ•°æ®
      </p>
    </div>
  );
};

// è½¦å‹åˆ†å¸ƒé¥¼å›¾
const VehicleTypeDistributionChart: React.FC<{
  data: Record<string, any>;
}> = ({ data }) => {
  return (
    <div className="grid grid-cols-2 gap-4">
      <div className="h-64">
        {/* é¥¼å›¾ */}
      </div>
      <div>
        {/* ç»Ÿè®¡è¡¨æ ¼ */}
        <table className="min-w-full text-sm">
          <thead>
            <tr className="border-b">
              <th className="text-left py-2">è½¦å‹</th>
              <th className="text-right py-2">æ•°é‡</th>
              <th className="text-right py-2">å æ¯”</th>
            </tr>
          </thead>
          <tbody>
            {Object.entries(data).map(([type, stats]: [string, any]) => (
              <tr key={type} className="border-b">
                <td className="py-2">{type}</td>
                <td className="text-right">{stats.count}</td>
                <td className="text-right">{stats.percentage.toFixed(1)}%</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

// å·¥å…·å‡½æ•°
const getBusyLevelColor = (level: string) => {
  switch (level) {
    case 'HIGH': return 'text-red-600';
    case 'MEDIUM': return 'text-yellow-600';
    case 'LOW': return 'text-green-600';
    default: return 'text-gray-600';
  }
};

export default GantryProfileView;
```

##### **API å®¢æˆ·ç«¯**

```typescript
// web/src/api/profile.ts
import axios from 'axios';

const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080';

export const profileApi = {
  /**
   * è·å–é—¨æ¶ç”»åƒ
   */
  getGantryProfile: async (
    gantryId: string,
    startDate: string,
    endDate: string
  ) => {
    const response = await axios.get(
      `${API_BASE_URL}/api/v1/profiles/gantry/${gantryId}`,
      { params: { startDate, endDate } }
    );
    return response.data.data;
  },

  /**
   * è·å–è½¦è¾†ç”»åƒ
   */
  getVehicleProfile: async (
    vehicleId: string,
    startDate: string,
    endDate: string
  ) => {
    const response = await axios.get(
      `${API_BASE_URL}/api/v1/profiles/vehicle/${vehicleId}`,
      { params: { startDate, endDate } }
    );
    return response.data.data;
  },

  /**
   * æ‰¹é‡è·å–é—¨æ¶ç”»åƒï¼ˆç”¨äºå¯¹æ¯”ï¼‰
   */
  batchGetGantryProfiles: async (
    gantryIds: string[],
    startDate: string,
    endDate: string
  ) => {
    const response = await axios.post(
      `${API_BASE_URL}/api/v1/profiles/gantry/batch`,
      { gantryIds, startDate, endDate }
    );
    return response.data.data;
  },
};
```

---

### 3.3 æ–¹æ¡ˆBè¯¦ç»†è®¾è®¡ï¼ˆé¢„è®¡ç®—ç¼“å­˜ï¼‰

#### **3.3.1 å®šæ—¶ä»»åŠ¡å®ç°**

```java
// src/main/java/com/mypalantir/scheduler/ProfileScheduler.java
package com.mypalantir.scheduler;

@Component
@EnableScheduling
public class ProfileScheduler {
    
    private final ProfileCacheService profileCacheService;
    
    /**
     * æ¯æ—¥å‡Œæ™¨2ç‚¹æ›´æ–°é—¨æ¶ç”»åƒç¼“å­˜
     */
    @Scheduled(cron = "0 0 2 * * ?")
    public void updateDailyGantryProfiles() {
        LocalDate yesterday = LocalDate.now().minusDays(1);
        
        try {
            profileCacheService.batchUpdateGantryProfiles(
                ProfileType.DAILY,
                yesterday
            );
            log.info("Daily gantry profiles updated for date: {}", yesterday);
        } catch (Exception e) {
            log.error("Failed to update daily gantry profiles", e);
        }
    }
    
    /**
     * æ¯å‘¨ä¸€å‡Œæ™¨3ç‚¹æ›´æ–°å‘¨åº¦ç”»åƒ
     */
    @Scheduled(cron = "0 0 3 ? * MON")
    public void updateWeeklyProfiles() {
        LocalDate lastWeekEnd = LocalDate.now().minusWeeks(1);
        LocalDate lastWeekStart = lastWeekEnd.minusDays(6);
        
        profileCacheService.batchUpdateGantryProfiles(
            ProfileType.WEEKLY,
            lastWeekStart,
            lastWeekEnd
        );
    }
}
```

#### **3.3.2 ç¼“å­˜æœåŠ¡å®ç°**

```java
// src/main/java/com/mypalantir/service/ProfileCacheService.java
@Service
public class ProfileCacheService {
    
    private final ProfileService profileService;
    private final ProfileCacheRepository cacheRepository;
    
    /**
     * æ‰¹é‡æ›´æ–°é—¨æ¶ç”»åƒç¼“å­˜
     */
    @Transactional
    public void batchUpdateGantryProfiles(
        ProfileType profileType,
        LocalDate date
    ) throws Exception {
        // è·å–æ‰€æœ‰é—¨æ¶
        List<String> gantryIds = getAllGantryIds();
        
        LocalDate startDate = date;
        LocalDate endDate = date;
        
        for (String gantryId : gantryIds) {
            try {
                // ç”Ÿæˆç”»åƒ
                GantryProfileData profile = profileService.generateGantryProfile(
                    gantryId,
                    startDate,
                    endDate
                );
                
                // ä¿å­˜åˆ°ç¼“å­˜
                ProfileCache cache = new ProfileCache();
                cache.setId(UUID.randomUUID().toString());
                cache.setEntityType("Gantry");
                cache.setEntityId(gantryId);
                cache.setProfileType(profileType.name().toLowerCase());
                cache.setProfileDate(date);
                cache.setMetricsJson(JsonUtils.toJson(profile));
                
                cacheRepository.save(cache);
                
            } catch (Exception e) {
                log.error("Failed to update profile for gantry: {}", gantryId, e);
                // ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ª
            }
        }
    }
    
    /**
     * ä»ç¼“å­˜è¯»å–ç”»åƒ
     */
    public GantryProfileData getGantryProfileFromCache(
        String gantryId,
        ProfileType profileType,
        LocalDate date
    ) {
        Optional<ProfileCache> cache = cacheRepository.findByEntityAndDate(
            "Gantry",
            gantryId,
            profileType.name().toLowerCase(),
            date
        );
        
        if (cache.isPresent()) {
            return JsonUtils.fromJson(
                cache.get().getMetricsJson(),
                GantryProfileData.class
            );
        }
        
        return null;
    }
}
```

---

## å››ã€å®æ–½è·¯å¾„

### 4.1 åˆ†é˜¶æ®µå®æ–½

#### **Phase 1: MVP å¿«é€ŸéªŒè¯ï¼ˆ1-2å‘¨ï¼‰**

**ç›®æ ‡**ï¼šéªŒè¯ç”»åƒåŠŸèƒ½çš„ä¸šåŠ¡ä»·å€¼

**äº¤ä»˜å†…å®¹**ï¼š
1. åç«¯ ProfileController å’Œ ProfileServiceï¼ˆæ–¹æ¡ˆAï¼‰
2. å‰ç«¯é—¨æ¶ç”»åƒé¡µé¢ï¼ˆåŸºç¡€ç‰ˆï¼‰
3. 3-5 ä¸ªæ ¸å¿ƒæŒ‡æ ‡å±•ç¤º

**è¯„ä¼°æŒ‡æ ‡**ï¼š
- ç”¨æˆ·è®¿é—®é‡
- é¡µé¢åŠ è½½æ—¶é—´ï¼ˆ< 3sï¼‰
- ç”¨æˆ·åé¦ˆ

---

#### **Phase 2: åŠŸèƒ½å®Œå–„ï¼ˆ2-3å‘¨ï¼‰**

**ç›®æ ‡**ï¼šå¢å¼ºç”»åƒç»´åº¦å’Œäº¤äº’ä½“éªŒ

**äº¤ä»˜å†…å®¹**ï¼š
1. è½¦è¾†ç”»åƒé¡µé¢
2. å›¾è¡¨å¯è§†åŒ–å¢å¼ºï¼ˆæ¥å…¥ rechartsï¼‰
3. ç”»åƒå¯¹æ¯”åŠŸèƒ½
4. æ•°æ®å¯¼å‡ºåŠŸèƒ½

---

#### **Phase 3: æ€§èƒ½ä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰**

**ç›®æ ‡**ï¼šæå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæ”¯æŒå¤§è§„æ¨¡è®¿é—®

**äº¤ä»˜å†…å®¹**ï¼š
1. å¼•å…¥ç¼“å­˜æœºåˆ¶ï¼ˆæ–¹æ¡ˆBï¼‰
2. å®šæ—¶ä»»åŠ¡æ‰¹é‡è®¡ç®—
3. ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§
4. å†å²ç”»åƒè¶‹åŠ¿åˆ†æ

---

### 4.2 æŠ€æœ¯ä¾èµ–æ¸…å•

**åç«¯**ï¼š
- Spring Bootï¼ˆå·²æœ‰ï¼‰
- Metric Systemï¼ˆå·²æœ‰ï¼‰
- Query Serviceï¼ˆå·²æœ‰ï¼‰
- Jacksonï¼ˆJSONå¤„ç†ï¼Œå·²æœ‰ï¼‰

**å‰ç«¯**ï¼š
- React + TypeScriptï¼ˆå·²æœ‰ï¼‰
- Rechartsï¼ˆå›¾è¡¨åº“ï¼Œéœ€æ–°å¢ï¼‰
- Tailwind CSSï¼ˆå·²æœ‰ï¼‰

**æ•°æ®åº“**ï¼š
- H2ï¼ˆæµ‹è¯•ç¯å¢ƒï¼Œå·²æœ‰ï¼‰
- MySQL/PostgreSQLï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

---

## äº”ã€æ‰©å±•æ–¹å‘

### 5.1 æ™ºèƒ½åˆ†æ

- **å¼‚å¸¸æ£€æµ‹**ï¼šåŸºäºå†å²ç”»åƒè¯†åˆ«å¼‚å¸¸æ³¢åŠ¨
- **é¢„æµ‹åˆ†æ**ï¼šé¢„æµ‹æœªæ¥æµé‡å’Œæ”¶å…¥è¶‹åŠ¿
- **æ™ºèƒ½æ¨è**ï¼šæ¨èä¼˜åŒ–ç­–ç•¥

### 5.2 æ ‡ç­¾ä½“ç³»

- **è‡ªå®šä¹‰æ ‡ç­¾**ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ç”»åƒç»´åº¦
- **æ ‡ç­¾ç®¡ç†**ï¼šæ ‡ç­¾çš„å¢åˆ æ”¹æŸ¥
- **æ ‡ç­¾ç»„åˆ**ï¼šå¤šæ ‡ç­¾è”åˆåˆ†æ

### 5.3 ç”»åƒåº”ç”¨

- **ç²¾å‡†è¥é”€**ï¼šåŸºäºè½¦è¾†ç”»åƒçš„å·®å¼‚åŒ–å®šä»·
- **èµ„æºä¼˜åŒ–**ï¼šåŸºäºé—¨æ¶ç”»åƒçš„è®¾å¤‡ç»´æŠ¤è®¡åˆ’
- **é£é™©æ§åˆ¶**ï¼šå¼‚å¸¸é€šè¡Œè¡Œä¸ºè¯†åˆ«

---

## å…­ã€æ€»ç»“

### 6.1 æ ¸å¿ƒä¼˜åŠ¿

1. **æ¶æ„ç®€æ´**ï¼šåŸºäºç°æœ‰æŒ‡æ ‡ç³»ç»Ÿï¼Œæ— éœ€é‡æ„
2. **å®æ–½å¿«é€Ÿ**ï¼šæ–¹æ¡ˆAå¯åœ¨2å‘¨å†…å®ŒæˆMVP
3. **æ‰©å±•çµæ´»**ï¼šæ”¯æŒæŒ‰éœ€å¢åŠ ç”»åƒç»´åº¦
4. **æ€§èƒ½å¯æ§**ï¼šæ–¹æ¡ˆBæä¾›ç¼“å­˜ä¼˜åŒ–è·¯å¾„

### 6.2 å…³é”®æˆåŠŸå› ç´ 

1. **æŒ‡æ ‡å®Œå¤‡æ€§**ï¼šç”»åƒè´¨é‡ä¾èµ–åº•å±‚æŒ‡æ ‡è¦†ç›–åº¦
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§æ•°æ®é‡åœºæ™¯éœ€å¼•å…¥ç¼“å­˜æœºåˆ¶
3. **ç”¨æˆ·ä½“éªŒ**ï¼šå¯è§†åŒ–è®¾è®¡å’Œäº¤äº’æµç•…åº¦
4. **ä¸šåŠ¡ä»·å€¼**ï¼šç”»åƒæ´å¯Ÿéœ€è½¬åŒ–ä¸ºå®é™…ä¸šåŠ¡å†³ç­–

### 6.3 é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|---------|
| æ•°æ®é‡å¤§å¯¼è‡´æŸ¥è¯¢æ…¢ | é¡µé¢åŠ è½½è¶…æ—¶ | å¼•å…¥ç¼“å­˜æœºåˆ¶ï¼ˆæ–¹æ¡ˆBï¼‰ |
| æŒ‡æ ‡ç»´åº¦ä¸è¶³ | ç”»åƒä¿¡æ¯ä¸å…¨ | å…ˆå®Œå–„æŒ‡æ ‡ä½“ç³» |
| å‰ç«¯å›¾è¡¨æ€§èƒ½å·® | ç”¨æˆ·ä½“éªŒä¸ä½³ | æ•°æ®åˆ†é¡µ + è™šæ‹Ÿæ»šåŠ¨ |
| å†å²æ•°æ®ç¼ºå¤± | ç”»åƒä¸å‡†ç¡® | è®¾å®šæœ€å°æ•°æ®é‡é˜ˆå€¼ |

---

## ä¸ƒã€é™„å½•

### 7.1 æŒ‡æ ‡æ¸…å•

**é—¨æ¶ç”»åƒéœ€è¦çš„æŒ‡æ ‡**ï¼š
1. æ€»äº¤æ˜“é‡ï¼ˆåŸå­æŒ‡æ ‡ï¼‰
2. æ€»æ”¶å…¥ï¼ˆåŸå­æŒ‡æ ‡ï¼‰
3. å¹³å‡å•ç¬”é‡‘é¢ï¼ˆæ´¾ç”ŸæŒ‡æ ‡ï¼‰
4. æŒ‰å°æ—¶èšåˆçš„äº¤æ˜“é‡ï¼ˆè‡ªå®šä¹‰æŸ¥è¯¢ï¼‰
5. æŒ‰è½¦å‹èšåˆçš„äº¤æ˜“é‡å’Œæ”¶å…¥ï¼ˆè‡ªå®šä¹‰æŸ¥è¯¢ï¼‰

**è½¦è¾†ç”»åƒéœ€è¦çš„æŒ‡æ ‡**ï¼š
1. æ€»é€šè¡Œæ¬¡æ•°ï¼ˆåŸå­æŒ‡æ ‡ï¼‰
2. æ€»é‡Œç¨‹ï¼ˆåŸå­æŒ‡æ ‡ï¼‰
3. æ€»è´¹ç”¨ï¼ˆåŸå­æŒ‡æ ‡ï¼‰
4. å¸¸ç”¨è·¯çº¿ï¼ˆè‡ªå®šä¹‰æŸ¥è¯¢ + TOP Nï¼‰
5. å¸¸ç”¨æ”¶è´¹ç«™ï¼ˆè‡ªå®šä¹‰æŸ¥è¯¢ + TOP Nï¼‰
6. æ´»è·ƒæ—¶æ®µåˆ†å¸ƒï¼ˆè‡ªå®šä¹‰æŸ¥è¯¢ï¼‰

### 7.2 é…ç½®é¡¹

```properties
# application.properties

# ç”»åƒåŠŸèƒ½å¼€å…³
profile.enabled=true

# ç¼“å­˜ç­–ç•¥
profile.cache.enabled=false
profile.cache.ttl=86400

# ç¹å¿™åº¦è¯„çº§é˜ˆå€¼
profile.gantry.busy.low.threshold=100
profile.gantry.busy.medium.threshold=500

# ç”¨æˆ·åˆ†ç±»é˜ˆå€¼ï¼ˆé€šè¡Œæ¬¡æ•°/æœˆï¼‰
profile.vehicle.high-freq.threshold=20
profile.vehicle.medium-freq.threshold=5

# æ‰¹é‡è®¡ç®—é…ç½®
profile.batch.size=100
profile.batch.parallel=true
```

### 7.3 å‚è€ƒèµ„æ–™

- [æŒ‡æ ‡ç³»ç»Ÿè®¾è®¡æ–‡æ¡£](./METRIC_SYSTEM.md)
- [Query Builder ä½¿ç”¨æŒ‡å—](./QUERY_BUILDER.md)
- [Recharts å®˜æ–¹æ–‡æ¡£](https://recharts.org/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-15  
**ä½œè€…**: Qoder  
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ
